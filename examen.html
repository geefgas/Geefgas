<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GeefGas â€“ Examen</title>

  <link rel="stylesheet" href="styles.css">
  <script src="exam-data.js"></script>
</head>

<body class="theme examPage">

<!-- ================= TOPBAR ================= -->
<header class="topbar">
  <div class="examTop">
    <div class="examTop__brand">
      <img src="assets/geefgas.PNG" alt="GeefGas" height="28">
    </div>
    <div class="pillTimer" id="timerPill">--:--</div>
  </div>
</header>

<!-- ================= PAGE ================= -->
<main class="page">
  <div class="container page__inner">

    <section class="examCard">

      <!-- FOTO (alleen zichtbaar als er echt een afbeelding is) -->
      <div class="examMedia" id="mediaWrap" style="display:none;">
        <img id="questionImage" alt="Afbeelding bij vraag"
             onerror="this.closest('.examMedia').style.display='none';">
      </div>

      <div class="examBody">

        <!-- META -->
        <div class="examMeta">
          <div class="chip" id="chipTopic">Taxi</div>
          <div class="muted" id="chipProgress">Vraag 1 van 40</div>
        </div>

        <!-- VRAAG -->
        <h2 id="questionText">â€”</h2>

        <!-- ANTWOORDEN -->
        <div class="answers" id="answers"></div>

        <!-- UITLEG -->
        <div class="explain" id="explainBox" style="display:none;">
          <div class="explainTitle" id="explainTitle"></div>
          <div class="explainText" id="explainText"></div>
        </div>

        <!-- NAVIGATIE -->
        <div class="examFooter">
          <button class="btn btn--ghost" id="speakBtn" type="button">
            ðŸ”Š Voorlezen
          </button>

          <div class="examNavBtns">
            <button class="btn btn--ghost" id="prevBtn" type="button">
              Vorige
            </button>
            <button class="btn btn--gold" id="nextBtn" type="button">
              Volgende
            </button>
          </div>
        </div>

        <!-- INFO (subtiel & luxe) -->
        <div class="examInfo">
          Mode: <span id="modeLabel">â€”</span> â€¢
          Norm: <span id="normLabel">â€”</span>
        </div>

      </div>
    </section>

  </div>
</main>

<!-- ================= SCRIPT ================= -->
<script>
(function(){
  const $ = id => document.getElementById(id);

  /* ===== INSTELLINGEN ===== */
  const revealMode = localStorage.getItem("gg_revealMode") || "instant";
  $("modeLabel").textContent =
    revealMode === "after" ? "feedback na examen" : "directe feedback";

  const examId = localStorage.getItem("gg_examId");
  const exams = window.EXAM_DATA?.exams || [];
  const exam = exams.find(e => String(e.id) === String(examId));

  if (!exam){
    alert("Geen examen gevonden.");
    location.href = "examens.html";
    return;
  }

  const questions = exam.questions;
  const total = questions.length;
  let index = 0;
  let answers = new Array(total).fill(null);
  let locked = false;

  $("chipTopic").textContent = exam.category;
  $("normLabel").textContent =
    `${exam.passMinCorrect}/${total} goed (max ${total - exam.passMinCorrect} fouten)`;

  /* ===== TIMER ===== */
  let time = exam.durationMinutes * 60;
  updateTimer();

  const timer = setInterval(() => {
    time--;
    updateTimer();
    if (time <= 0){
      clearInterval(timer);
      finishExam(true);
    }
  }, 1000);

  function updateTimer(){
    const m = String(Math.floor(time / 60)).padStart(2,"0");
    const s = String(time % 60).padStart(2,"0");
    $("timerPill").textContent = `${m}:${s}`;
  }

  /* ===== RENDER ===== */
  function render(){
    const q = questions[index];
    locked = false;

    $("chipProgress").textContent = `Vraag ${index + 1} van ${total}`;
    $("questionText").textContent = q.prompt;

    if (q.image){
      $("mediaWrap").style.display = "";
      $("questionImage").src = q.image;
    } else {
      $("mediaWrap").style.display = "none";
    }

    const list = $("answers");
    list.innerHTML = "";

    q.options.forEach((opt,i)=>{
      const btn = document.createElement("button");
      btn.className = "answer";
      btn.innerHTML = `
        <span class="answerKey">${String.fromCharCode(65+i)}</span>
        <span>${opt}</span>
      `;
      if (answers[index] === i) btn.classList.add("selected");
      btn.onclick = () => choose(i);
      list.appendChild(btn);
    });

    $("prevBtn").disabled = index === 0;
    $("nextBtn").textContent = index === total - 1 ? "Afronden" : "Volgende";
  }

  function choose(i){
    if (locked) return;
    answers[index] = i;

    [...$("answers").children].forEach((el,idx)=>{
      el.classList.toggle("selected", idx === i);
      el.classList.remove("correct","wrong");
    });

    if (revealMode === "after") return;

    locked = true;
    const correct = questions[index].correctIndex;
    if (typeof correct !== "number") return;

    const nodes = $("answers").children;
    nodes[correct].classList.add("correct");
    if (i !== correct) nodes[i].classList.add("wrong");

    if (questions[index].explanation){
      $("explainBox").style.display = "";
      $("explainTitle").textContent = i === correct ? "Goed" : "Fout";
      $("explainText").textContent = questions[index].explanation;
      $("explainBox").className =
        "explain " + (i === correct ? "good" : "bad");
    }
  }

  $("prevBtn").onclick = () => {
    if (index > 0){ index--; render(); }
  };

  $("nextBtn").onclick = () => {
    if (index === total - 1) finishExam(false);
    else { index++; render(); }
  };

  $("speakBtn").onclick = () => {
    const q = questions[index];
    const text = q.prompt + ". " + q.options.join(". ");
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "nl-NL";
    speechSynthesis.speak(u);
  };

  function finishExam(timeUp){
    clearInterval(timer);
    localStorage.setItem("gg_result", JSON.stringify({
      examId: examId,
      title: exam.title,
      total: total,
      answers: answers,
      timeUp: timeUp
    }));
    location.href = "resultaat.html";
  }

  render();
})();
</script>

</body>
</html>
